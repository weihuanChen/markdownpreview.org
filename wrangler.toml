#:schema node_modules/wrangler/config-schema.json
name = "markdownpreview-org"
compatibility_date = "2025-11-12"
workers_dev = true

# 主 Worker 配置（OpenNext 构建输出）
main = ".open-next/worker.js"

# 静态资产目录
assets = { directory = ".open-next/assets", binding = "ASSETS" }

# 兼容性标志（支持 Node.js API）
compatibility_flags = ["nodejs_compat"]

# Durable Objects 绑定（用于缓存）
[[durable_objects.bindings]]
name = "DO_QUEUE"
class_name = "DOQueueHandler"
script_name = "markdownpreview-org"

[[durable_objects.bindings]]
name = "DO_TAG_CACHE"
class_name = "DOShardedTagCache"
script_name = "markdownpreview-org"

# 迁移配置
[[migrations]]
tag = "v1"
new_classes = ["DOQueueHandler", "DOShardedTagCache", "BucketCachePurge"]

# 变量
[vars]
DIRECTUS_URL = "https://directus.lzyinglian.com/"
NEXT_PUBLIC_SITE_ID=5

[observability]
[observability.logs]
enabled = false
head_sampling_rate = 1
invocation_logs = true
persist = true