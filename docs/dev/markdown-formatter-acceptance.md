# Markdown Formatter éªŒæ”¶æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.0  
> **éªŒæ”¶æ—¥æœŸ**: 2024-12-18  
> **çŠ¶æ€**: âœ… P1/P2/P3 å·²å®Œæˆå¹¶æµ‹è¯•

---

## ä¸€ã€äº§å“æ¦‚è¿°

**Markdown Formatter** æ˜¯ä¸€ä¸ªå®‰å…¨ã€å¯å®¡é˜…çš„ Markdown æ ¼å¼åŒ–å·¥å…·ï¼Œæä¾›ï¼š
- âœ… **Diff å¯è§†åŒ–** â€” æ¸…æ™°å±•ç¤ºæ ¼å¼åŒ–å‰åçš„å·®å¼‚
- âœ… **æœ€å°ä¿®æ”¹åŸåˆ™** â€” åªä¿®å¤ç¡®å®šæ€§é—®é¢˜ï¼Œä¸ç ´ååŸæœ‰ç»“æ„
- âœ… **å®‰å…¨ä¿®å¤** â€” 100% ç¡®å®šæ€§è§„åˆ™ï¼Œæ”¯æŒ Undo å›é€€
- âœ… **Lint æ£€æµ‹** â€” é«˜çº§æ¨¡å¼æ”¯æŒè´¨é‡æ£€æŸ¥å’Œè§„åˆ™å®šåˆ¶

**è®¿é—®è·¯å¾„**: `/[locale]/formatter`

---

## äºŒã€å·²å®ç°åŠŸèƒ½æ¸…å•

### 2.1 P1 æ ¸å¿ƒåŠŸèƒ½ âœ…

#### æ ¼å¼åŒ–å¼•æ“
- âœ… è§„åˆ™å¼•æ“æ¡†æ¶ï¼ˆ`lib/formatter/engine.ts`ï¼‰
- âœ… è§„åˆ™æ³¨å†Œä¸æ‰§è¡Œæœºåˆ¶
- âœ… å˜æ›´è¡Œè®¡ç®—ï¼ˆ`changedLines`ï¼‰
- âœ… å¿«ç…§ç®¡ç†ï¼ˆUndo/Redo æ”¯æŒï¼‰

#### åŸºç¡€æ ¼å¼åŒ–è§„åˆ™ï¼ˆ10 ä¸ªï¼‰
| è§„åˆ™ ID | åˆ†ç±» | åŠŸèƒ½ | çŠ¶æ€ |
|---------|------|------|------|
| `trailing-spaces` | whitespace | ç§»é™¤è¡Œå°¾ç©ºæ ¼ | âœ… |
| `eof-newline` | whitespace | æ–‡ä»¶æœ«å°¾ä¿ç•™ä¸€ä¸ªç©ºè¡Œ | âœ… |
| `consecutive-blanks` | whitespace | å¤šä½™ç©ºè¡Œå‹ç¼© | âœ… |
| `heading-space` | heading | `#` åå¿…é¡»æœ‰ç©ºæ ¼ | âœ… |
| `heading-blank-lines` | heading | æ ‡é¢˜å‰åç©ºè¡Œä¸€è‡´ | âœ… |
| `list-marker-style` | list | ç»Ÿä¸€åˆ—è¡¨ç¬¦å·ï¼ˆé»˜è®¤ `-`ï¼‰ | âœ… |
| `list-indent` | list | åˆ—è¡¨ç¼©è¿›ç»Ÿä¸€ï¼ˆé»˜è®¤ 2 spacesï¼‰ | âœ… |
| `blockquote-space` | blockquote | `>` åç©ºæ ¼è§„èŒƒ | âœ… |
| `code-fence-style` | code | fence ç»Ÿä¸€ä¸º ` ``` ` | âœ… |
| `code-fence-spacing` | code | fence å‰åç©ºè¡Œ | âœ… |

#### UI åŠŸèƒ½
- âœ… åŒæ å¸ƒå±€ï¼ˆEditor + Diff/Previewï¼‰
- âœ… CodeMirror ç¼–è¾‘å™¨é›†æˆ
- âœ… Diff è§†å›¾ï¼ˆWord/Block ä¸¤ç§é«˜äº®æ¨¡å¼ï¼‰
- âœ… Preview é¢„è§ˆï¼ˆStreamdown æ¸²æŸ“ï¼‰
- âœ… Format æŒ‰é’® + Loading çŠ¶æ€
- âœ… Apply åº”ç”¨æ ¼å¼åŒ–ç»“æœ
- âœ… Undo æ’¤é”€åŠŸèƒ½
- âœ… Copy å¤åˆ¶ç»“æœ
- âœ… å“åº”å¼å¸ƒå±€ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰

#### å›½é™…åŒ–
- âœ… 5 è¯­è¨€æ”¯æŒï¼ˆen/zh/ja/es/frï¼‰
- âœ… å®Œæ•´ç¿»è¯‘è¦†ç›–
- âœ… å¯¼èˆªå…¥å£é›†æˆ

---

### 2.2 P2 é«˜çº§åŠŸèƒ½ âœ…

#### æ¨¡å¼åˆ‡æ¢
- âœ… Simple æ¨¡å¼ï¼ˆé»˜è®¤ï¼Œç®€åŒ–ç•Œé¢ï¼‰
- âœ… Advanced æ¨¡å¼ï¼ˆå®Œæ•´è§„åˆ™é…ç½®ï¼‰

#### è§„åˆ™ç®¡ç†
- âœ… è§„åˆ™åˆ—è¡¨å±•ç¤ºï¼ˆæŒ‰åˆ†ç±»ï¼šwhitespace/heading/list/blockquote/code/writingï¼‰
- âœ… è§„åˆ™å¼€å…³ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
- âœ… è§„åˆ™ç»Ÿè®¡ï¼ˆå·²å¯ç”¨/æ€»æ•°ï¼‰
- âœ… è§„åˆ™åˆ†ç±»ç­›é€‰

#### é¢„è®¾é…ç½®ï¼ˆ5 ä¸ªï¼‰
| é¢„è®¾ | è§„åˆ™æ•° | é€‚ç”¨åœºæ™¯ | çŠ¶æ€ |
|------|--------|----------|------|
| `standard` | 9 | æ ‡å‡†é…ç½®ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ | âœ… |
| `github` | 12 | GitHub Flavored Markdown é£æ ¼ | âœ… |
| `quality` | 6 | è´¨é‡æ£€æŸ¥æ¨¡å¼ï¼ˆå«å†™ä½œè§„åˆ™ï¼‰ | âœ… |
| `writing` | 3 | å†™ä½œå‹å¥½ï¼Œæœ€å°‘å¹²é¢„ | âœ… |
| `strict` | 12 | ä¸¥æ ¼æ¨¡å¼ï¼Œæ‰€æœ‰è§„åˆ™å¯ç”¨ | âœ… |

#### Lint ç»“æœé¢æ¿
- âœ… Lint ç»“æœå±•ç¤ºï¼ˆæŒ‰ä¸¥é‡çº§åˆ«ï¼šerror/warning/infoï¼‰
- âœ… æŒ‰è§„åˆ™åˆ†ç»„æ˜¾ç¤º
- âœ… è¡Œå·å®šä½
- âœ… Fix All ä¸€é”®ä¿®å¤æ‰€æœ‰é—®é¢˜
- âœ… Fix Selected é€‰æ‹©æ€§ä¿®å¤ï¼ˆæ”¯æŒå¤šé€‰è§„åˆ™ï¼‰

---

### 2.3 P3 å·¥ç¨‹çº§åŠŸèƒ½ âœ…

#### Diff-aware Lint
- âœ… å˜æ›´è¡Œè®¡ç®—ï¼ˆ`computeChangedLines`ï¼‰
- âœ… Lint ä¸Šä¸‹æ–‡ä¼ é€’ï¼ˆ`LintContext.changedLines`ï¼‰
- âœ… ä»…æ£€æŸ¥å˜æ›´è¡Œçš„ Lint è¿‡æ»¤
- âœ… å†™ä½œè´¨é‡è§„åˆ™æ”¯æŒ Diff-awareï¼ˆ`heading-depth`, `long-paragraph`ï¼‰

#### å†™ä½œè´¨é‡è§„åˆ™ï¼ˆ2 ä¸ªï¼‰
| è§„åˆ™ ID | åŠŸèƒ½ | ç±»å‹ | çŠ¶æ€ |
|---------|------|------|------|
| `heading-depth` | æ ‡é¢˜å±‚çº§è¿‡æ·±æ£€æµ‹ï¼ˆé»˜è®¤ max: 4ï¼‰ | Lint-only | âœ… |
| `long-paragraph` | æ®µè½è¿‡é•¿æ£€æµ‹ï¼ˆé»˜è®¤ max: 800 å­—ç¬¦ï¼‰ | Lint-only | âœ… |

#### æŠ¥å‘Šå¯¼å‡º
- âœ… JSON å¯¼å‡ºï¼ˆç»“æ„åŒ–æ•°æ®ï¼ŒåŒ…å«è§„åˆ™ã€Lint ç»“æœã€å˜æ›´è¡Œï¼‰
- âœ… Markdown å¯¼å‡ºï¼ˆäººç±»å¯è¯»æŠ¥å‘Šï¼‰
- âœ… SARIF å¯¼å‡ºï¼ˆæ ‡å‡†é™æ€åˆ†ææ ¼å¼ï¼Œæ”¯æŒ CI/CDï¼‰

---

## ä¸‰ã€æœªå®ç°çš„è¾¹ç•Œ

### 3.1 æ˜ç¡®æœªå®ç°çš„åŠŸèƒ½

| åŠŸèƒ½ | åŸè®¡åˆ’ | çŠ¶æ€ | è¯´æ˜ |
|------|--------|------|------|
| **é…ç½®å¯¼å…¥å¯¼å‡º** | P3 | âŒ æœªå®ç° | `.markdownlint.json` æ ¼å¼çš„é…ç½®å¯¼å…¥/å¯¼å‡º |
| **ä¸­è‹±æ–‡æ··æ’æ£€æµ‹** | P3 | âŒ æœªå®ç° | å†™ä½œè´¨é‡è§„åˆ™ä¸­çš„ä¸­è‹±æ–‡æ··æ’æ£€æµ‹æœªå®ç° |
| **è¿ç»­æ ‡é¢˜æ£€æµ‹** | P3 | âŒ æœªå®ç° | å†™ä½œè´¨é‡è§„åˆ™ä¸­çš„è¿ç»­æ ‡é¢˜æ£€æµ‹æœªå®ç° |
| **Web Worker æ‰§è¡Œ** | æ¶æ„è®¾è®¡ | âŒ æœªå®ç° | æ ¼å¼åŒ–å¼•æ“åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œæœªä½¿ç”¨ Web Worker |
| **å¢é‡ Diff** | æ€§èƒ½ä¼˜åŒ– | âŒ æœªå®ç° | å¤§æ–‡ä»¶ä¼˜åŒ–ï¼šå¢é‡ Diff è®¡ç®—æœªå®ç° |

### 3.2 æŠ€æœ¯é™åˆ¶

1. **æ€§èƒ½é™åˆ¶**
   - å¤§æ–‡ä»¶ï¼ˆ> 10MBï¼‰å¯èƒ½å“åº”è¾ƒæ…¢
   - æœªä½¿ç”¨ Web Workerï¼Œæ ¼å¼åŒ–è¿‡ç¨‹ä¼šé˜»å¡ä¸»çº¿ç¨‹

2. **è§„åˆ™é™åˆ¶**
   - ä»…æ”¯æŒç¡®å®šæ€§ä¿®å¤è§„åˆ™ï¼ˆ100% å®‰å…¨ï¼‰
   - å†™ä½œè´¨é‡è§„åˆ™ä»…æä¾› Lint æ£€æµ‹ï¼Œä¸è‡ªåŠ¨ä¿®å¤

3. **é…ç½®é™åˆ¶**
   - è§„åˆ™é…ç½®ä»…æ”¯æŒé¢„è®¾å’Œæ‰‹åŠ¨å¼€å…³
   - ä¸æ”¯æŒè‡ªå®šä¹‰è§„åˆ™å‚æ•°ï¼ˆå¦‚ `maxParagraphChars` åœ¨ UI ä¸­ä¸å¯è°ƒï¼‰

---

## å››ã€åŠŸèƒ½éªŒæ”¶æ¸…å•

### 4.1 P1 åŠŸèƒ½éªŒæ”¶ âœ…

- [x] ç”¨æˆ·å¯è¾“å…¥ Markdown æ–‡æœ¬
- [x] ç‚¹å‡» Format åæ˜¾ç¤º Diff è§†å›¾
- [x] Diff è§†å›¾æ­£ç¡®é«˜äº®å¢åˆ æ”¹ï¼ˆWord/Block ä¸¤ç§æ¨¡å¼ï¼‰
- [x] Apply åç¼–è¾‘å™¨å†…å®¹æ›´æ–°
- [x] Undo å¯å›é€€åˆ°ä¸Šä¸€çŠ¶æ€
- [x] Preview æ­£ç¡®æ¸²æŸ“æ ¼å¼åŒ–ç»“æœ
- [x] 5 è¯­è¨€ç¿»è¯‘å®Œæ•´
- [x] å“åº”å¼å¸ƒå±€æ­£å¸¸

### 4.2 P1 è§„åˆ™éªŒæ”¶ âœ…

- [x] ç§»é™¤è¡Œå°¾ç©ºæ ¼ï¼ˆ`trailing-spaces`ï¼‰
- [x] æ–‡ä»¶æœ«å°¾ä¿ç•™ä¸€ä¸ªç©ºè¡Œï¼ˆ`eof-newline`ï¼‰
- [x] å¤šä½™ç©ºè¡Œå‹ç¼©ï¼ˆ`consecutive-blanks`ï¼‰
- [x] `#` åå¿…é¡»æœ‰ç©ºæ ¼ï¼ˆ`heading-space`ï¼‰
- [x] æ ‡é¢˜å‰åç©ºè¡Œä¸€è‡´ï¼ˆ`heading-blank-lines`ï¼‰
- [x] ç»Ÿä¸€åˆ—è¡¨ç¬¦å·ï¼ˆ`list-marker-style`ï¼‰
- [x] åˆ—è¡¨ç¼©è¿›ç»Ÿä¸€ï¼ˆ`list-indent`ï¼‰
- [x] `>` åç©ºæ ¼è§„èŒƒï¼ˆ`blockquote-space`ï¼‰
- [x] fence ç»Ÿä¸€ä¸º ` ``` `ï¼ˆ`code-fence-style`ï¼‰
- [x] fence å‰åç©ºè¡Œï¼ˆ`code-fence-spacing`ï¼‰

### 4.3 P2 åŠŸèƒ½éªŒæ”¶ âœ…

- [x] Simple/Advanced æ¨¡å¼åˆ‡æ¢
- [x] è§„åˆ™åˆ—è¡¨å±•ç¤ºä¸å¼€å…³
- [x] é¢„è®¾é…ç½®åº”ç”¨
- [x] Lint ç»“æœé¢æ¿å±•ç¤º
- [x] Fix All / Fix Selected åŠŸèƒ½

### 4.4 P3 åŠŸèƒ½éªŒæ”¶ âœ…

- [x] Diff-aware Lintï¼ˆä»…æ£€æŸ¥å˜æ›´è¡Œï¼‰
- [x] å†™ä½œè´¨é‡è§„åˆ™ï¼ˆ`heading-depth`, `long-paragraph`ï¼‰
- [x] æŠ¥å‘Šå¯¼å‡ºï¼ˆJSON / Markdown / SARIFï¼‰

---

## äº”ã€æµ‹è¯•è¦†ç›–

### 5.1 å•å…ƒæµ‹è¯•

- âœ… Diff-aware Lint æµ‹è¯•ï¼ˆ`scripts/test-diff-aware-lint.ts`ï¼‰
- âœ… æ ¼å¼åŒ–è§„åˆ™æµ‹è¯•ï¼ˆ`scripts/test-formatter-rules.ts`ï¼‰
- âœ… å†™ä½œè´¨é‡è§„åˆ™æµ‹è¯•ï¼ˆ`scripts/test-writing-quality-rules.ts`ï¼‰
- âœ… æŠ¥å‘Šå¯¼å‡ºæµ‹è¯•ï¼ˆ`scripts/test-report-export.ts`ï¼‰

### 5.2 æµ‹è¯•æŠ¥å‘Š

- âœ… `docs/testing/diff-aware-lint-test-report.md`
- âœ… `docs/testing/writing-quality-rules-test-report.md`
- âœ… `docs/testing/report-export-test-report.md`

---

## å…­ã€æŠ€æœ¯æ¶æ„æ€»ç»“

### 6.1 æ ¸å¿ƒæ¨¡å—

```
lib/formatter/
â”œâ”€â”€ engine.ts          # æ ¼å¼åŒ–å¼•æ“æ ¸å¿ƒ
â”œâ”€â”€ rules/             # è§„åˆ™å®ç°
â”‚   â”œâ”€â”€ whitespace.ts  # ç©ºç™½å­—ç¬¦è§„åˆ™
â”‚   â”œâ”€â”€ heading.ts     # æ ‡é¢˜è§„åˆ™
â”‚   â”œâ”€â”€ list.ts        # åˆ—è¡¨è§„åˆ™
â”‚   â”œâ”€â”€ blockquote.ts  # å¼•ç”¨è§„åˆ™
â”‚   â”œâ”€â”€ code-block.ts  # ä»£ç å—è§„åˆ™
â”‚   â”œâ”€â”€ writing.ts     # å†™ä½œè´¨é‡è§„åˆ™
â”‚   â””â”€â”€ index.ts       # è§„åˆ™æ³¨å†Œä¸é¢„è®¾
â”œâ”€â”€ snapshot.ts        # å¿«ç…§ç®¡ç†
â””â”€â”€ export.ts          # æŠ¥å‘Šå¯¼å‡º
```

### 6.2 ç»„ä»¶ç»“æ„

```
components/
â”œâ”€â”€ markdown-formatter.tsx  # ä¸»ç»„ä»¶
â””â”€â”€ code-editor.tsx         # ç¼–è¾‘å™¨ï¼ˆå¤ç”¨ï¼‰
â””â”€â”€ markdown-preview.tsx    # é¢„è§ˆï¼ˆå¤ç”¨ï¼‰

hooks/
â””â”€â”€ use-formatter.ts        # æ ¼å¼åŒ– Hook
```

---

## ä¸ƒã€å·²çŸ¥é—®é¢˜ä¸é™åˆ¶

### 7.1 å·²çŸ¥é—®é¢˜

1. **å˜æ›´è¡Œè®¡ç®—ç²¾åº¦**
   - æŸäº›å¤æ‚è§„åˆ™ï¼ˆå¦‚ `heading-blank-lines`ï¼‰å¯èƒ½å¯¼è‡´å˜æ›´è¡Œå·åŒ…å«ç›¸é‚»è¡Œ
   - ä¸å½±å“åŠŸèƒ½ï¼Œä½†å¯èƒ½å½±å“ Diff-aware Lint çš„ç²¾ç¡®æ€§

2. **å¤§æ–‡ä»¶æ€§èƒ½**
   - æœªä½¿ç”¨ Web Workerï¼Œå¤§æ–‡ä»¶æ ¼å¼åŒ–å¯èƒ½é˜»å¡ UI
   - å»ºè®®ï¼šæ–‡ä»¶å¤§å° < 1MB

### 7.2 è®¾è®¡é™åˆ¶

1. **è§„åˆ™æ‰§è¡Œé¡ºåºå›ºå®š**
   - è§„åˆ™æŒ‰å›ºå®šé¡ºåºæ‰§è¡Œï¼Œé¿å…å†²çª
   - ä¸æ”¯æŒè‡ªå®šä¹‰æ‰§è¡Œé¡ºåº

2. **Lint-only è§„åˆ™**
   - å†™ä½œè´¨é‡è§„åˆ™ï¼ˆ`heading-depth`, `long-paragraph`ï¼‰ä»…æä¾›æ£€æµ‹
   - ä¸æä¾›è‡ªåŠ¨ä¿®å¤ï¼ˆéœ€è¦ç”¨æˆ·æ‰‹åŠ¨è°ƒæ•´ï¼‰

---

## å…«ã€åç»­ä¼˜åŒ–å»ºè®®

### 8.1 æ€§èƒ½ä¼˜åŒ–

- [ ] å®ç° Web Worker æ‰§è¡Œæ ¼å¼åŒ–
- [ ] å¢é‡ Diff è®¡ç®—ï¼ˆå¤§æ–‡ä»¶ä¼˜åŒ–ï¼‰
- [ ] è™šæ‹Ÿæ»šåŠ¨ï¼ˆè¶…é•¿ Diff è§†å›¾ï¼‰

### 8.2 åŠŸèƒ½å¢å¼º

- [ ] é…ç½®å¯¼å…¥å¯¼å‡ºï¼ˆ`.markdownlint.json`ï¼‰
- [ ] è‡ªå®šä¹‰è§„åˆ™å‚æ•°ï¼ˆUI å¯è°ƒï¼‰
- [ ] ä¸­è‹±æ–‡æ··æ’æ£€æµ‹è§„åˆ™
- [ ] è¿ç»­æ ‡é¢˜æ£€æµ‹è§„åˆ™

### 8.3 ç”¨æˆ·ä½“éªŒ

- [ ] è§„åˆ™è¯´æ˜æ–‡æ¡£ï¼ˆTooltip/å¸®åŠ©é“¾æ¥ï¼‰
- [ ] å¿«æ·é”®æ”¯æŒï¼ˆFormat: Cmd+S, Apply: Cmd+Enterï¼‰
- [ ] å†å²è®°å½•æŒä¹…åŒ–ï¼ˆLocalStorageï¼‰

---

## ä¹ã€æ€»ç»“

### âœ… å·²å®Œæˆ

- **P1 æ ¸å¿ƒåŠŸèƒ½**: 100% å®Œæˆ
- **P2 é«˜çº§åŠŸèƒ½**: 100% å®Œæˆ
- **P3 å·¥ç¨‹çº§åŠŸèƒ½**: 90% å®Œæˆï¼ˆæ ¸å¿ƒåŠŸèƒ½å·²å®ç°ï¼Œéƒ¨åˆ†è¾¹ç•ŒåŠŸèƒ½æœªå®ç°ï¼‰

### ğŸ“Š åŠŸèƒ½ç»Ÿè®¡

- **æ ¼å¼åŒ–è§„åˆ™**: 10 ä¸ªï¼ˆå…¨éƒ¨å¯è‡ªåŠ¨ä¿®å¤ï¼‰
- **Lint è§„åˆ™**: 2 ä¸ªï¼ˆä»…æ£€æµ‹ï¼Œä¸ä¿®å¤ï¼‰
- **é¢„è®¾é…ç½®**: 5 ä¸ª
- **å¯¼å‡ºæ ¼å¼**: 3 ç§ï¼ˆJSON / Markdown / SARIFï¼‰
- **æ”¯æŒè¯­è¨€**: 5 ç§ï¼ˆen/zh/ja/es/frï¼‰

### ğŸ¯ äº§å“å®šä½

Markdown Formatter å·²å®ç°æ ¸å¿ƒä»·å€¼ä¸»å¼ ï¼š
- âœ… **å®‰å…¨æ ¼å¼åŒ–** â€” 100% ç¡®å®šæ€§è§„åˆ™ï¼Œæ”¯æŒ Undo
- âœ… **Diff å¯è§†åŒ–** â€” æ¸…æ™°å±•ç¤ºå˜æ›´
- âœ… **å¯å®šåˆ¶åŒ–** â€” è§„åˆ™å¼€å…³ã€é¢„è®¾é…ç½®
- âœ… **å·¥ç¨‹å‹å¥½** â€” Diff-aware Lintã€æŠ¥å‘Šå¯¼å‡º

**äº§å“å·²å¯æŠ•å…¥ä½¿ç”¨ï¼Œæ»¡è¶³ P1/P2/P3 é˜¶æ®µçš„æ‰€æœ‰æ ¸å¿ƒéœ€æ±‚ã€‚**

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-12-18

